import React, { useState } from 'react';

const STEMVisualization = () => {
  const [selectedConnections, setSelectedConnections] = useState([]);
  const [selectedDiscipline, setSelectedDiscipline] = useState(null);

  // STEM disciplines positioned in a diamond layout
  const disciplines = [
    { id: 'science', name: 'Science', color: '#3b82f6', x: 275, y: 50 },
    { id: 'technology', name: 'Technology', color: '#8b5cf6', x: 475, y: 250 },
    { id: 'math', name: 'Mathematics', color: '#ef4444', x: 75, y: 250 },
    { id: 'engineering', name: 'Engineering', color: '#10b981', x: 275, y: 450 }
  ];

  // Sub-disciplines for each STEM area
  const subDisciplines = {
    science: [
      'Biology',
      'Chemistry',
      'Physics',
      'Marine Science',
      'Environmental Science',
      'Astronomy',
      'Geology',
      'Neuroscience'
    ],
    technology: [
      'Computer Science',
      'Information Technology',
      'Cybersecurity',
      'Software Development',
      'Data Analytics',
      'Web Development',
      'Artificial Intelligence',
      'Robotics'
    ],
    engineering: [
      'Mechanical Engineering',
      'Electrical Engineering',
      'Civil Engineering',
      'Aerospace Engineering',
      'Industrial Engineering',
      'Environmental Engineering',
      'Software Engineering',
      'Chemical Engineering'
    ],
    math: [
      'Algebra',
      'Calculus',
      'Statistics',
      'Geometry',
      'Trigonometry',
      'Applied Mathematics',
      'Pure Mathematics',
      'Mathematical Modeling'
    ]
  };

  // Connections between disciplines with real-world examples
  const connections = [
    {
      id: 1,
      from: 'engineering',
      to: 'technology',
      field: 'Mechanical Engineering',
      description: 'Using technology and computational tools to design and optimize mechanical systems',
      profession: 'Mechanical Engineer'
    },
    {
      id: 2,
      from: 'science',
      to: 'technology',
      field: 'Bioinformatics',
      description: 'Applying computational technology to analyze biological data and genetic information',
      profession: 'Bioinformatics Scientist'
    },
    {
      id: 3,
      from: 'math',
      to: 'engineering',
      field: 'Structural Analysis',
      description: 'Using mathematical calculations to ensure structural integrity and safety',
      profession: 'Structural Engineer'
    },
    {
      id: 4,
      from: 'science',
      to: 'math',
      field: 'Theoretical Physics',
      description: 'Using advanced mathematics to model and understand physical phenomena',
      profession: 'Theoretical Physicist'
    },
    {
      id: 5,
      from: 'science',
      to: 'engineering',
      field: 'Biomedical Engineering',
      description: 'Applying engineering principles to medicine and biology for healthcare solutions',
      profession: 'Biomedical Engineer'
    },
    {
      id: 6,
      from: 'technology',
      to: 'math',
      field: 'Data Science',
      description: 'Using statistical mathematics and programming to extract insights from data',
      profession: 'Data Scientist'
    },
    {
      id: 7,
      from: 'engineering',
      to: 'science',
      field: 'Chemical Engineering',
      description: 'Applying chemistry and physics principles to design industrial processes',
      profession: 'Chemical Engineer'
    },
    {
      id: 8,
      from: 'math',
      to: 'technology',
      field: 'Cryptography',
      description: 'Using number theory and algorithms to secure digital communications',
      profession: 'Cryptographer / Security Engineer'
    },
    {
      id: 9,
      from: 'technology',
      to: 'science',
      field: 'Computational Chemistry',
      description: 'Simulating molecular behavior using computer algorithms and software',
      profession: 'Computational Chemist'
    },
    {
      id: 10,
      from: 'technology',
      to: 'science',
      field: 'Medical Imaging',
      description: 'Using advanced technology like MRI, CT, and ultrasound to visualize internal body structures',
      profession: 'Radiologic Technologist / Medical Imaging Specialist'
    },
    {
      id: 11,
      from: 'engineering',
      to: 'science',
      field: 'Prosthetics Design',
      description: 'Engineering artificial limbs and devices using knowledge of human anatomy and biomechanics',
      profession: 'Prosthetist / Orthotist'
    },
    {
      id: 12,
      from: 'math',
      to: 'science',
      field: 'Epidemiology',
      description: 'Using statistical methods to study disease patterns and public health trends',
      profession: 'Epidemiologist'
    },
    {
      id: 13,
      from: 'technology',
      to: 'engineering',
      field: 'Medical Robotics',
      description: 'Developing robotic systems for surgery, rehabilitation, and patient care',
      profession: 'Medical Robotics Engineer'
    },
    {
      id: 14,
      from: 'science',
      to: 'technology',
      field: 'Health Informatics',
      description: 'Managing and analyzing healthcare data to improve patient outcomes and hospital systems',
      profession: 'Health Informatics Specialist'
    },
    {
      id: 15,
      from: 'engineering',
      to: 'technology',
      field: 'Medical Device Engineering',
      description: 'Designing and developing medical equipment like pacemakers, monitors, and surgical tools',
      profession: 'Medical Device Engineer'
    },
    {
      id: 16,
      from: 'math',
      to: 'science',
      field: 'Pharmacology Modeling',
      description: 'Using mathematical models to predict drug interactions and optimal dosing',
      profession: 'Clinical Pharmacologist / Pharmacometrician'
    },
    {
      id: 17,
      from: 'engineering',
      to: 'math',
      field: 'Control Systems Engineering',
      description: 'Using mathematical models to design automated control systems',
      profession: 'Control Systems Engineer'
    },
    {
      id: 32,
      from: 'engineering',
      to: 'math',
      field: 'Aerospace Engineering',
      description: 'Applying advanced mathematics and calculus to design aircraft and spacecraft trajectories',
      profession: 'Aerospace Engineer'
    },
    {
      id: 33,
      from: 'engineering',
      to: 'math',
      field: 'Data Science Engineering',
      description: 'Using statistical mathematics and engineering principles to build data-driven systems',
      profession: 'Data Science Engineer'
    },
    {
      id: 34,
      from: 'engineering',
      to: 'math',
      field: 'Actuarial Science',
      description: 'Applying mathematical and statistical methods to assess risk in engineering and insurance contexts',
      profession: 'Actuary'
    },
    {
      id: 35,
      from: 'engineering',
      to: 'math',
      field: 'Electrical Engineering',
      description: 'Using mathematical equations and models to design electrical circuits and systems',
      profession: 'Electrical Engineer'
    },
    {
      id: 36,
      from: 'engineering',
      to: 'math',
      field: 'Industrial Engineering',
      description: 'Applying optimization mathematics to improve manufacturing and operational efficiency',
      profession: 'Industrial Engineer'
    },
    {
      id: 37,
      from: 'engineering',
      to: 'math',
      field: 'Algorithm Engineering',
      description: 'Using mathematical algorithms and computational theory to solve complex engineering problems',
      profession: 'Algorithm Engineer'
    },
    {
      id: 18,
      from: 'technology',
      to: 'math',
      field: 'Machine Learning',
      description: 'Applying statistical algorithms and computational methods to enable computers to learn from data',
      profession: 'Machine Learning Engineer'
    },
    {
      id: 40,
      from: 'technology',
      to: 'math',
      field: 'Cybersecurity Analysis',
      description: 'Using cryptographic mathematics and security technology to protect systems and data',
      profession: 'Cybersecurity Analyst'
    },
    {
      id: 41,
      from: 'technology',
      to: 'math',
      field: 'Quantitative Analysis',
      description: 'Applying mathematical models and algorithms to analyze financial markets and trading strategies',
      profession: 'Quantitative Analyst'
    },
    {
      id: 42,
      from: 'technology',
      to: 'math',
      field: 'Operations Research',
      description: 'Using mathematical optimization and computational modeling to solve complex business problems',
      profession: 'Operations Research Analyst'
    },
    {
      id: 43,
      from: 'technology',
      to: 'math',
      field: 'Computer Graphics Programming',
      description: 'Applying linear algebra and geometry with programming to create visual simulations and games',
      profession: 'Computer Graphics Programmer'
    },
    {
      id: 19,
      from: 'science',
      to: 'engineering',
      field: 'Environmental Engineering',
      description: 'Using engineering solutions to address environmental challenges and protect ecosystems',
      profession: 'Environmental Engineer'
    },
    {
      id: 38,
      from: 'science',
      to: 'engineering',
      field: 'Biochemistry',
      description: 'Applying chemistry and biology principles with engineering methods to study biological processes',
      profession: 'Biochemist'
    },
    {
      id: 39,
      from: 'science',
      to: 'engineering',
      field: 'Petroleum Engineering',
      description: 'Using geological science and engineering techniques to extract oil and natural gas',
      profession: 'Petroleum Engineer'
    },
    {
      id: 20,
      from: 'technology',
      to: 'engineering',
      field: 'Automation Engineering',
      description: 'Developing automated systems and robotics for manufacturing and industrial processes',
      profession: 'Automation Engineer'
    },
    {
      id: 21,
      from: 'engineering',
      to: 'technology',
      field: 'Aerospace Engineering',
      description: 'Using computational design tools and technology to develop aircraft and spacecraft systems',
      profession: 'Aerospace Engineer'
    },
    {
      id: 22,
      from: 'engineering',
      to: 'technology',
      field: 'Chemical Engineering',
      description: 'Applying technology and computational methods to design and optimize chemical processes',
      profession: 'Chemical Engineer'
    },
    {
      id: 23,
      from: 'engineering',
      to: 'technology',
      field: 'Civil Engineering',
      description: 'Using design software and technology to plan and construct infrastructure projects',
      profession: 'Civil Engineer'
    },
    {
      id: 24,
      from: 'engineering',
      to: 'technology',
      field: 'Software Engineering',
      description: 'Applying engineering principles to develop and maintain software systems',
      profession: 'Software Developer / Software Engineer'
    },
    {
      id: 25,
      from: 'engineering',
      to: 'technology',
      field: 'Systems Integration',
      description: 'Combining engineering knowledge with technology to integrate complex hardware and software systems',
      profession: 'Systems Integration Engineer'
    },
    {
      id: 26,
      from: 'engineering',
      to: 'technology',
      field: 'Technical Writing',
      description: 'Using technical knowledge and digital tools to create documentation for engineering and technology products',
      profession: 'Technical Writer'
    },
    {
      id: 27,
      from: 'engineering',
      to: 'technology',
      field: 'Urban and Regional Planning',
      description: 'Applying engineering principles and GIS technology to plan sustainable communities and infrastructure',
      profession: 'Urban and Regional Planner'
    },
    {
      id: 28,
      from: 'science',
      to: 'math',
      field: 'Economics',
      description: 'Using mathematical models to understand economic behavior and market dynamics',
      profession: 'Economist'
    },
    {
      id: 29,
      from: 'science',
      to: 'math',
      field: 'Astronomy',
      description: 'Using mathematical equations and models to study celestial objects and phenomena',
      profession: 'Astronomer'
    },
    {
      id: 30,
      from: 'science',
      to: 'technology',
      field: 'Geophysics',
      description: 'Using computational tools and sensors to study Earth\'s physical properties and structure',
      profession: 'Geophysicist'
    },
    {
      id: 31,
      from: 'science',
      to: 'technology',
      field: 'Cartography',
      description: 'Combining geographic science with GIS technology to create maps and spatial data visualizations',
      profession: 'Cartographer'
    }
  ];

  const getPosition = (disciplineId) => {
    const disc = disciplines.find(d => d.id === disciplineId);
    return { x: disc.x, y: disc.y };
  };

  const getMidpoint = (from, to) => {
    const fromPos = getPosition(from);
    const toPos = getPosition(to);
    
    // Calculate the direction vector from 'from' to 'to'
    const dx = toPos.x - fromPos.x;
    const dy = toPos.y - fromPos.y;
    const length = Math.sqrt(dx * dx + dy * dy);
    
    // Default to exact midpoint
    let t = 0.5;
    
    // Adjust position along the line for overlapping pairs
    const pairKey = [from, to].sort().join('-');
    
    if (pairKey === 'engineering-science') {
      t = 0.4; // Move toward science (closer to top)
    } else if (pairKey === 'math-technology') {
      t = 0.6; // Move toward technology (closer to right)
    }
    
    // Calculate position along the line
    const x = fromPos.x + dx * t;
    const y = fromPos.y + dy * t;
    
    return { x, y };
  };

  const getConnectionsForPair = (from, to) => {
    return connections.filter(conn => 
      (conn.from === from && conn.to === to) || 
      (conn.from === to && conn.to === from)
    );
  };

  const handleConnectionClick = (from, to) => {
    const conns = getConnectionsForPair(from, to);
    if (conns.length > 0) {
      setSelectedConnections(conns);
      setSelectedDiscipline(null);
    }
  };

  const handleDisciplineClick = (disciplineId) => {
    setSelectedDiscipline(disciplineId);
    setSelectedConnections([]);
  };

  return (
    <div className="w-full min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 flex flex-col items-center justify-start p-4 overflow-auto">
      <div className="my-4 text-center">
        <h1 className="text-3xl font-bold text-white mb-2">STEM Two-Discipline Connections</h1>
        <p className="text-slate-300">Click on connection lines to see how disciplines intersect</p>
      </div>

      <div className="relative bg-slate-800 rounded-2xl shadow-2xl p-4">
        <svg width="550" height="520" className="mb-4">
          {/* Draw connection lines - group by discipline pairs */}
          {Array.from(new Set(connections.map(c => [c.from, c.to].sort().join('-')))).map(pairKey => {
            const [from, to] = pairKey.split('-');
            const pairConnections = getConnectionsForPair(from, to);
            const fromPos = getPosition(from);
            const toPos = getPosition(to);
            const isSelected = selectedConnections.length > 0 && 
              selectedConnections.some(sc => 
                (sc.from === from && sc.to === to) || 
                (sc.from === to && sc.to === from)
              );
            
            return (
              <g key={pairKey}>
                {/* Invisible wider line for better click detection */}
                <line
                  x1={fromPos.x}
                  y1={fromPos.y}
                  x2={toPos.x}
                  y2={toPos.y}
                  stroke="transparent"
                  strokeWidth="20"
                  className="cursor-pointer"
                  onClick={() => handleConnectionClick(from, to)}
                />
                {/* Visible line */}
                <line
                  x1={fromPos.x}
                  y1={fromPos.y}
                  x2={toPos.x}
                  y2={toPos.y}
                  stroke={isSelected ? '#fbbf24' : '#475569'}
                  strokeWidth={isSelected ? '4' : '2'}
                  strokeDasharray={isSelected ? '0' : '5,5'}
                  className="pointer-events-none transition-all duration-300"
                  style={{ opacity: isSelected ? 1 : 0.4 }}
                />
              </g>
            );
          })}

          {/* Draw discipline nodes */}
          {disciplines.map(disc => (
            <g key={disc.id} onClick={() => handleDisciplineClick(disc.id)} className="cursor-pointer">
              <circle
                cx={disc.x}
                cy={disc.y}
                r="45"
                fill={disc.color}
                className="drop-shadow-lg hover:opacity-90 transition-opacity"
                stroke={selectedDiscipline === disc.id ? '#fbbf24' : 'none'}
                strokeWidth="4"
              />
              <text
                x={disc.x}
                y={disc.y}
                textAnchor="middle"
                dominantBaseline="middle"
                className="text-white font-bold text-sm pointer-events-none"
                fill="white"
              >
                {disc.name}
              </text>
            </g>
          ))}

          {/* Draw midpoint circles on top */}
          {Array.from(new Set(connections.map(c => [c.from, c.to].sort().join('-')))).map(pairKey => {
            const [from, to] = pairKey.split('-');
            const pairConnections = getConnectionsForPair(from, to);
            const midpoint = getMidpoint(from, to);
            const isSelected = selectedConnections.length > 0 && 
              selectedConnections.some(sc => 
                (sc.from === from && sc.to === to) || 
                (sc.from === to && sc.to === from)
              );
            
            return (
              <g key={`circle-${pairKey}`}>
                <g className="cursor-pointer" onClick={() => handleConnectionClick(from, to)}>
                  {/* Outer glow circle for visibility */}
                  <circle
                    cx={midpoint.x}
                    cy={midpoint.y}
                    r="20"
                    fill="none"
                    stroke={isSelected ? '#fbbf24' : '#64748b'}
                    strokeWidth="2"
                    className="hover:stroke-amber-400 transition-all"
                    opacity="0.5"
                  />
                  <circle
                    cx={midpoint.x}
                    cy={midpoint.y}
                    r="16"
                    fill={isSelected ? '#fbbf24' : '#64748b'}
                    className="hover:scale-110 transition-transform cursor-pointer"
                    stroke="white"
                    strokeWidth="2"
                  />
                  <text
                    x={midpoint.x}
                    y={midpoint.y}
                    textAnchor="middle"
                    dominantBaseline="middle"
                    className="text-white font-bold text-sm pointer-events-none"
                    fill="white"
                  >
                    {pairConnections.length}
                  </text>
                </g>
              </g>
            );
          })}
        </svg>

        {/* Info panel */}
        <div className="mt-4 bg-slate-700 rounded-lg p-4 min-h-24 max-h-96 overflow-y-auto">
          {selectedDiscipline ? (
            <div>
              <h3 className="text-2xl font-bold mb-3" style={{ color: disciplines.find(d => d.id === selectedDiscipline)?.color }}>
                {disciplines.find(d => d.id === selectedDiscipline)?.name} Sub-Disciplines
              </h3>
              <div className="grid grid-cols-2 gap-2">
                {subDisciplines[selectedDiscipline].map((sub, idx) => (
                  <div key={idx} className="bg-slate-600 rounded px-3 py-2 text-slate-200 text-sm">
                    • {sub}
                  </div>
                ))}
              </div>
            </div>
          ) : selectedConnections.length > 0 ? (
            <div>
              <p className="text-slate-300 text-xs mb-3">
                <span className="font-semibold text-blue-300">
                  {disciplines.find(d => d.id === selectedConnections[0].from)?.name}
                </span>
                {' + '}
                <span className="font-semibold text-blue-300">
                  {disciplines.find(d => d.id === selectedConnections[0].to)?.name}
                </span>
                {' — '}
                <span className="text-amber-300">{selectedConnections.length} connection{selectedConnections.length > 1 ? 's' : ''}</span>
              </p>
              {selectedConnections.map((conn, idx) => (
                <div key={conn.id} className={`${idx > 0 ? 'mt-4 pt-4 border-t border-slate-600' : ''}`}>
                  <h3 className="text-lg font-bold text-amber-400 mb-1">
                    {conn.field}
                  </h3>
                  <p className="text-emerald-300 font-semibold text-sm mb-1">
                    Profession: {conn.profession}
                  </p>
                  <p className="text-slate-300 text-sm">{conn.description}</p>
                </div>
              ))}
            </div>
          ) : (
            <div className="text-center text-slate-400">
              <p className="text-base">Select a connection or discipline to learn more</p>
              <p className="text-xs mt-2">Click on connection lines/dots to see professions</p>
              <p className="text-xs mt-1">Click on colored circles to see sub-disciplines</p>
            </div>
          )}
        </div>
      </div>

      <div className="my-4 text-slate-400 text-xs text-center max-w-md">
        <p>STEM visualization showing technical and scientific interdisciplinary connections</p>
      </div>
    </div>
  );
};

export default STEMVisualization;